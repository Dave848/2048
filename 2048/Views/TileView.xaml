<UserControl x:Class="_2048.Views.TileView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity">

    <UserControl.Resources>
        <Storyboard x:Key="TileSpawnStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                             From="0" To="1" Duration="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                             From="0" To="1" Duration="0:0:0.2"/>
        </Storyboard>

        <Storyboard x:Key="TileMergeStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                     From="1" To="1.2" Duration="0:0:0.1" AutoReverse="True"/>
            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                     From="1" To="1.2" Duration="0:0:0.1" AutoReverse="True"/>
        </Storyboard>
    </UserControl.Resources>

    <Border CornerRadius="5"
            Padding="10"
            Background="{Binding BackgroundColor}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Margin="5"
            RenderTransformOrigin="0.5, 0.5">

        <Border.RenderTransform>
            <ScaleTransform x:Name="scale" ScaleX="1" ScaleY="1"/>
        </Border.RenderTransform>

        <Border.Style>
            <Style TargetType="Border">
                <Style.Triggers>
                    <!-- Spawn animation -->
                    <DataTrigger Binding="{Binding JustSpawned}" Value="True">
                        <DataTrigger.EnterActions>
                            <BeginStoryboard x:Name="SpawnAnimation" Storyboard="{StaticResource TileSpawnStoryboard}"/>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <StopStoryboard BeginStoryboardName="SpawnAnimation"/>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                    <!-- Spawn animation -->

                    <!-- Merge animation -->
                    <DataTrigger Binding="{Binding JustMerged}" Value="True">
                        <DataTrigger.EnterActions>
                            <BeginStoryboard x:Name="MergeAnimation" Storyboard="{StaticResource TileMergeStoryboard}"/>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <StopStoryboard BeginStoryboardName="MergeAnimation"/>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                    <!-- Merge animation -->
                </Style.Triggers>
            </Style>
        </Border.Style>

        <TextBlock Text="{Binding Value}"
                   FontSize="24"
                   FontWeight="Bold"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Center">

            <TextBlock.Style>
                <Style TargetType="TextBlock">
                    <Setter Property="Visibility" Value="Visible"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Value}" Value="0">
                            <Setter Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>
        </TextBlock>
    </Border>
</UserControl>
